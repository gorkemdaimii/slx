<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈ûevvale Sevgilerle üíï</title>

    <!-- React -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Ses Efektleri -->
    <audio id="sound-open" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_4c50adbcac.mp3?filename=paper-slide-44547.mp3" preload="auto"></audio>
    <audio id="sound-pop" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_809e808eea.mp3?filename=pop-3-102646.mp3" preload="auto"></audio>
    <audio id="sound-sparkle" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_600ec9974e.mp3?filename=magic-dust-5988.mp3" preload="auto"></audio>

    <style>
        @keyframes envelopeOpen {
            0% { transform: rotateX(90deg); opacity: 0; }
            100% { transform: rotateX(0deg); opacity: 1; }
        }

        @keyframes letterSlideUp {
            0% { transform: translateY(30px); opacity: 0; }
            60% { opacity: 1; }
            100% { transform: translateY(-5px); opacity: 1; }
        }

        @keyframes envelopeFlyAway {
            0% { transform: scale(1) translateY(0); opacity: 1; }
            50% { transform: scale(0.85) translateY(-90px); }
            100% { transform: scale(0.65) translateY(-180px); opacity: 0; }
        }

        @keyframes heartFloatCinema {
            0% { transform: translateY(0px) scale(0.3) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-60px) scale(1) rotate(40deg); opacity: 0; }
        }

        @keyframes softBounceIn {
            0% { transform: translateY(25px) scale(0.92); opacity: 0; }
            50% { transform: translateY(0px) scale(1.04); opacity: 1; }
            100% { transform: scale(1); }
        }

        @keyframes readReceiptFade {
            0% { opacity: 0; transform: translateY(4px); }
            100% { opacity: 1; transform: translateY(0px); }
        }
    </style>
</head>

<body>
<div id="root"></div>

<script>
    const firebaseConfig = {
         apiKey: "AIzaSyBzF_kGylIuZKu2DnlOuMc-cU3YJwTGCHA",
         authDomain: "sevvals-239d0.firebaseapp.com",
         projectId: "sevvals-239d0",
         storageBucket: "sevvals-239d0.firebasestorage.app",
         messagingSenderId: "727817694816",
         appId: "1:727817694816:web:7282a82008d29ee0665d05",
         measurementId: "G-2KS65T0TRP"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
</script>

<script type="text/babel">

const { useState, useEffect } = React;

function HeartParticle({ x, y }) {
    return (
        <div
            className="absolute text-pink-400"
            style={{
                left: x,
                top: y,
                animation: "heartFloatCinema 1.5s ease-out forwards"
            }}>
            ‚ù§Ô∏è
        </div>
    );
}

function LetterAnimation({ text, onFinish }) {
    const [particles, setParticles] = useState([]);

    useEffect(() => {
        document.getElementById("sound-open")?.play();

        // kalp partik√ºlleri
        for (let i = 0; i < 6; i++) {
            setTimeout(() => {
                setParticles(prev => [...prev, {
                    id: Math.random(),
                    x: window.innerWidth / 2 + (Math.random() * 100 - 50),
                    y: window.innerHeight / 2 + (Math.random() * 40 - 20)
                }]);
                document.getElementById("sound-sparkle")?.play();
            }, 300 + i * 150);
        }

        setTimeout(() => {
            onFinish();
        }, 2500);
    }, []);

    return (
        <div className="fixed inset-0 flex items-center justify-center z-[9999] pointer-events-none">
            
            {particles.map(p => (
                <HeartParticle key={p.id} x={p.x} y={p.y} />
            ))}

            <div className="relative flex flex-col items-center">

                {/* Zarf */}
                <div
                    className="w-64 h-40 bg-white shadow-xl rounded-md border border-rose-300 flex items-center justify-center"
                    style={{ animation: "envelopeFlyAway 2.2s ease-out forwards", animationDelay: "1.3s" }}
                >
                    <div
                        className="absolute w-full h-20 bg-rose-200 border-b border-rose-300"
                        style={{
                            top: 0,
                            transformOrigin: "top center",
                            animation: "envelopeOpen 1.2s ease-out forwards"
                        }}
                    ></div>
                </div>

                {/* Mektup */}
                <div
                    className="absolute w-56 bg-white border border-rose-200 shadow-lg rounded-md p-4 text-center"
                    style={{
                        animation: "letterSlideUp 1.5s ease-out forwards",
                        animationDelay: "0.5s"
                    }}
                >
                    <p className="text-rose-500 font-bold mb-2 text-lg">üíå G√∂nderiliyor...</p>
                    <p className="text-gray-700 whitespace-pre-wrap">{text}</p>
                </div>

            </div>
        </div>
    );
}

function MessageWall() {
    const [messages, setMessages] = useState([]);
    const [newMessage, setNewMessage] = useState('');
    const [senderName, setSenderName] = useState('');
    const [sending, setSending] = useState(false);
    const [tempText, setTempText] = useState('');

    useEffect(() => {
        const unsub = db.collection("messages")
            .orderBy("timestamp", "desc")
            .onSnapshot(snap => {
                setMessages(snap.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                })));
            });

        return () => unsub();
    }, []);

    const addMessage = async () => {
        if (!newMessage.trim() || !senderName.trim()) return;

        setTempText(newMessage);
        setSending(true);

        document.getElementById("sound-pop")?.play();

        setTimeout(async () => {
            await db.collection("messages").add({
                text: newMessage,
                sender: senderName,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                color: `hsl(${Math.random() * 360},70%,65%)`
            });

            setNewMessage('');
        }, 1500);
    };

    return (
        <div className="min-h-screen bg-gradient-to-br from-rose-400 via-pink-500 to-purple-600 p-6 relative">

            {sending && (
                <LetterAnimation text={tempText} onFinish={() => setSending(false)} />
            )}

            <div className="max-w-2xl mx-auto">
                
                <div className="bg-white/30 backdrop-blur-xl p-6 rounded-3xl text-center mb-6">
                    <h1 className="text-white text-5xl font-bold">≈ûevvale Sevgilerle üíï</h1>
                    <p className="text-white mt-1">Seni d√º≈ü√ºnd√ºƒü√ºm her an burada.</p>
                </div>

                <div className="bg-white p-5 rounded-2xl shadow-xl mb-6">

                    <input
                        type="text"
                        className="w-full border p-3 rounded-xl mb-3"
                        placeholder="ƒ∞smin üíï"
                        value={senderName}
                        onChange={e => setSenderName(e.target.value)}
                    />

                    <textarea
                        className="w-full border p-3 rounded-xl"
                        placeholder="Mesajƒ±n üíå"
                        rows="3"
                        value={newMessage}
                        onChange={e => setNewMessage(e.target.value)}
                    ></textarea>

                    <button
                        onClick={addMessage}
                        className="mt-4 w-full bg-rose-500 hover:bg-rose-600 text-white p-3 rounded-xl font-bold"
                    >
                        G√∂nder
                    </button>
                </div>

                <div className="space-y-4">
                    {messages.map(m => (
                        <div
                            key={m.id}
                            className="bg-white p-5 rounded-2xl shadow-xl"
                            style={{ animation: "softBounceIn 0.7s ease-out" }}
                        >
                            <div className="flex justify-between">
                                <div>
                                    <p className="font-bold" style={{ color: m.color }}>{m.sender}</p>
                                    <p className="text-gray-500 text-sm">{m.timestamp?.toDate().toLocaleString("tr-TR")}</p>
                                </div>
                            </div>

                            <p className="text-gray-800 mt-3 whitespace-pre-wrap">{m.text}</p>

                            <p
                                className="text-rose-400 text-xs font-semibold mt-2"
                                style={{ animation: "readReceiptFade 1s ease-out forwards" }}
                            >
                                okundu üíó
                            </p>
                        </div>
                    ))}
                </div>

            </div>
        </div>
    );
}

ReactDOM.createRoot(document.getElementById("root")).render(<MessageWall />);
</script>

</body>
</html>
