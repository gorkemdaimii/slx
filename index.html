<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Åževvale Sevgilerle ðŸ’•</title>

    <!-- React + Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @keyframes envelopeOpen {
            0% { transform: rotateX(90deg); opacity: 0; }
            100% { transform: rotateX(0deg); opacity: 1; }
        }

        @keyframes letterSlideUp {
            0% { transform: translateY(40px); opacity: 0; }
            70% { opacity: 1; }
            100% { transform: translateY(-10px); opacity: 1; }
        }
    </style>
</head>

<body class="bg-rose-400/40">
    <div id="root"></div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyBzF_kGylIuZKu2DnlOuMc-cU3YJwTGCHA",
    authDomain: "sevvals-239d0.firebaseapp.com",
    projectId: "sevvals-239d0",
    storageBucket: "sevvals-239d0.firebasestorage.app",
    messagingSenderId: "727817694816",
    appId: "1:727817694816:web:7282a82008d29ee0665d05",
    measurementId: "G-2KS65T0TRP"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script type="text/babel">

const { useState, useEffect } = React;

/*  
â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
 FULL SCREEN INTRO LETTER
â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“  
*/
function IntroLetter({ message, onClose }) {
    if (!message) return null;

    return (
        <div className="fixed inset-0 flex items-center justify-center bg-rose-400/80 backdrop-blur-xl z-[9999]">

            <div className="relative flex flex-col items-center cursor-pointer"
                 onClick={onClose}>

                {/* Zarf gÃ¶vde */}
                <div className="w-72 h-48 bg-white border border-rose-300 shadow-2xl rounded-md flex items-center justify-center relative">

                    {/* Kapak */}
                    <div className="absolute top-0 w-full h-24 bg-rose-200 border-b border-rose-300"
                        style={{
                            transformOrigin: "top",
                            animation: "envelopeOpen 1.1s ease-out forwards"
                        }}>
                    </div>
                </div>

                {/* Mektup */}
                <div className="absolute w-64 bg-white border border-rose-200 shadow-xl rounded-md p-4 text-center"
                    style={{
                        animation: "letterSlideUp 1.4s ease-out forwards",
                        animationDelay: "0.3s"
                    }}>
                    <p className="text-rose-500 font-bold text-lg mb-1">
                        ðŸ’Œ Yeni bir mektubun var
                    </p>

                    <p className="text-gray-700 whitespace-pre-wrap">
                        {message?.text || ""}
                    </p>
                </div>

            </div>
        </div>
    );
}

/*  
â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“
 MAIN MESSAGE WALL
â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“  
*/
function MessageWall() {

    const [messages, setMessages] = useState([]);
    const [newMessage, setNewMessage] = useState("");
    const [senderName, setSenderName] = useState("");

    const [introMessage, setIntroMessage] = useState(null);
    const [showIntro, setShowIntro] = useState(false);

    // Firestore listener
    useEffect(() => {
        const unsub = db.collection("messages")
            .orderBy("timestamp", "desc")
            .onSnapshot(snapshot => {
                const arr = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                setMessages(arr);

                // unread varsa intro aÃ§
                if (arr.length > 0 && arr[0].unread === true) {
                    setIntroMessage(arr[0]);
                    setShowIntro(true);
                }
            });

        return () => unsub();
    }, []);

    // Mesaj gÃ¶nder
    const sendMessage = async () => {
        if (!senderName.trim() || !newMessage.trim()) return;

        await db.collection("messages").add({
            sender: senderName,
            text: newMessage,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            unread: true,
            color: `hsl(${Math.random() * 360}, 70%, 65%)`
        });

        setNewMessage("");
    };

    // Intro kapandÄ±ÄŸÄ±nda unread â†’ false yap
    const closeIntro = () => {
        if (introMessage) {
            db.collection("messages")
                .doc(introMessage.id)
                .update({ unread: false });
        }

        setShowIntro(false);
    };

    return (
        <div className="min-h-screen bg-gradient-to-br from-rose-400 via-pink-500 to-purple-600 p-6">

            {/* AÃ§Ä±lÄ±ÅŸ mektubu */}
            {showIntro && introMessage && (
                <IntroLetter message={introMessage} onClose={closeIntro} />
            )}

            {/* Header */}
            <div className="max-w-2xl mx-auto bg-white/30 backdrop-blur-xl p-6 rounded-3xl text-center mb-6">
                <h1 className="text-white text-5xl font-bold">Åževvale Sevgilerle ðŸ’•</h1>
                <p className="text-white mt-2">Seni dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼m her an burada.</p>
            </div>

            {/* Input alanÄ± */}
            <div className="max-w-2xl mx-auto bg-white p-5 rounded-2xl shadow-xl mb-6">

                <input
                    type="text"
                    className="w-full border p-3 rounded-xl mb-3"
                    placeholder="Ä°smin ðŸ’•"
                    value={senderName}
                    onChange={(e) => setSenderName(e.target.value)}
                />

                <textarea
                    className="w-full border p-3 rounded-xl mb-3"
                    placeholder="MesajÄ±n ðŸ’Œ"
                    rows="3"
                    value={newMessage}
                    onChange={(e) => setNewMessage(e.target.value)}
                />

                <button
                    onClick={sendMessage}
                    className="w-full bg-rose-500 hover:bg-rose-600 text-white p-3 rounded-xl font-bold">
                    GÃ¶nder
                </button>
            </div>

            {/* Mesajlar */}
            <div className="max-w-2xl mx-auto space-y-4">
                {messages.map(msg => (
                    <div key={msg.id} className="bg-white p-5 rounded-2xl shadow-xl">

                        <div className="flex justify-between">
                            <p className="font-bold" style={{ color: msg.color }}>{msg.sender}</p>
                            <p className="text-gray-500 text-sm">{msg.timestamp?.toDate().toLocaleString("tr-TR")}</p>
                        </div>

                        <p className="text-gray-800 mt-3 whitespace-pre-wrap">{msg.text}</p>

                    </div>
                ))}
            </div>

        </div>
    );
}

ReactDOM.createRoot(document.getElementById("root")).render(<MessageWall />);
</script>

</body>
</html>
